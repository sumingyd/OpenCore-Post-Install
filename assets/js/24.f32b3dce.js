(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{294:function(t,e,a){t.exports=a.p+"assets/img/ig-platform.6e2af721.png"},295:function(t,e,a){t.exports=a.p+"assets/img/device-id.ffa2b089.png"},446:function(t,e,a){"use strict";a.r(e);var i=a(10),n=Object(i.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"英特尔igpu补丁"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#英特尔igpu补丁"}},[t._v("#")]),t._v(" 英特尔iGPU补丁")]),t._v(" "),e("p",[t._v("本指南将更深入地探讨修补macOS以支持英特尔iGPU的更多硬件变化，包括正确的显示输出，修复颜色色调问题，HiDPI问题等。注意本指南"),e("strong",[t._v("不是")]),t._v("初学者教程，我们建议你按照指南中config.plist部分列出的推荐iGPU属性来开始。")]),t._v(" "),e("p",[t._v("本指南支持：")]),t._v(" "),e("ul",[e("li",[t._v("Sandy Bridge到Ice Lake的iGPU")])]),t._v(" "),e("h2",{attrs:{id:"术语"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#术语"}},[t._v("#")]),t._v(" 术语")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("术语")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Framebuffer")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("指的是macOS中用来驱动GPU的kext。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("Framebuffer Profile")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("帧缓冲器中的配置文件，它决定了iGPU将如何行动。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("WhateverGreen")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Kext用于修补GPU驱动，以更好地支持PC硬件。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("AAPL,ig-platform-id")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("macOS用来确定Ivy Bridge和更新版本的帧缓冲器配置文件的属性。")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("AAPL,snb-platform-id")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("macOS用于确定Sandy Bridge的帧缓冲器配置的属性")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("device-id")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("IOKit用于将硬件与kexts相匹配")])])])]),t._v(" "),e("h2",{attrs:{id:"开始工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开始工作"}},[t._v("#")]),t._v(" 开始工作")]),t._v(" "),e("p",[t._v("在我们跳入这个无底洞太深之前，我们应该先解释一下我们在做什么，以及为什么我们需要这样做。")]),t._v(" "),e("p",[e("strong",[t._v("基本的主题")]),t._v("。")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#aapl-ig-platform-id-explainer"}},[t._v("AAPL,ig-platform-id explainer")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#device-id-explainer"}},[t._v("device-id explainer")])])]),t._v(" "),e("h3",{attrs:{id:"aapl-ig-platform-id-explainer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aapl-ig-platform-id-explainer"}},[t._v("#")]),t._v(" AAPL,ig-platform-id explainer")]),t._v(" "),e("p",[t._v("在带有iGPU的Mac中，默认情况下有几种配置。")]),t._v(" "),e("ul",[e("li",[t._v("iGPU是唯一的显示输出\n"),e("ul",[e("li",[t._v("常见于没有dGPU的Mac Minis、MacBook Airs、13英寸MacBook Pros和iMac上")])])]),t._v(" "),e("li",[t._v("iGPU只用于内部显示，而dGPU则处理外部显示\n"),e("ul",[e("li",[t._v("常见于15英寸MacBook Pro")])])]),t._v(" "),e("li",[t._v("iGPU仅用于内部计算，而dGPU处理所有的显示输出\n"),e("ul",[e("li",[t._v("常见于包含dGPU的iMac。")])])])]),t._v(" "),e("p",[t._v("这一点之所以重要，是因为苹果在iGPU kexts中支持大量的iGPU配置，特别是被称为帧缓冲器个性。这些个性决定了许多事情，包括显示器的数量、允许的显示器类型、这些显示器的位置、所需的最小VRAM等，因此我们需要希望这些配置文件中有一个与我们的硬件相匹配，或者尝试修补它。")]),t._v(" "),e("p",[t._v("为了指定macOS中的帧缓冲器个性，我们使用OpenCore的DeviceProperties部分，添加一个名为"),e("code",[t._v("AAPL,ig-platform-id")]),t._v("的条目。")]),t._v(" "),e("ul",[e("li",[t._v("注意：在Sandy Bridge上，我们使用"),e("code",[t._v("AAPL,snb-platform-id")]),t._v("代替。")])]),t._v(" "),e("p",[t._v("该条目的格式为十六进制，并与实际值进行了字节交换。这些值的完整列表可以在WhateverGreen的手册中找到。"),e("a",{attrs:{href:"https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.IntelHD.en.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("FAQ.IntelHD.en.md"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("在这个例子中，让我们尝试找到一个与桌面HD4600 iGPU兼容的帧缓存。我们首先要向下滚动手册，直到找到"),e("a",{attrs:{href:"https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.IntelHD.en.md#Intel-hd-graphics-4200-5200-haswell-processors",target:"_blank",rel:"noopener noreferrer"}},[t._v("Intel HD Graphics 4200-5200（Haswell处理器）"),e("OutboundLink")],1),t._v("条目。在这里，我们得到了一份macOS中所有支持的帧缓冲器的列表，包括硬件类型（即移动与桌面）、VRAM要求等。如果你滚动到这个列表的底部，你还会得到一些推荐选项。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("台式机:\n 0x0D220003 (默认)\n笔记本电脑:\n 0x0A160000 (默认)\n 0x0A260005 (推荐)\n 0x0A260006 (推荐)\n空的帧缓冲区。\n 0x04120004 (默认)\n")])])]),e("p",[t._v("前两个条目是非常明显的，但是最后一个条目（Empty Framebuffer）指的是系统已经设置了dGPU，但是仍然在后台启用了iGPU来处理任务，比如硬件加速解码等它擅长的任务。")]),t._v(" "),e("p",[t._v("现在，由于我们使用的是台式机HD4600，我们将抓取相应的帧缓冲器配置文件。"),e("code",[t._v("0x0D220003")]),t._v("。")]),t._v(" "),e("p",[t._v("现在，我们不能在我们的config.plist中使用它。原因是它是大尾数的，而macOS的IOS服务树希望它是小尾数的。然而，要转换它非常简单。")]),t._v(" "),e("div",{staticClass:"language-md extra-class"},[e("pre",{pre:!0,attrs:{class:"language-md"}},[e("code",[e("span",{pre:!0,attrs:{class:"token title important"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("#")]),t._v(" 开始时，去掉0x，然后将它们成对隔开")]),t._v("\n0x0D220003 -> 0D 22 00 03\n\n"),e("span",{pre:!0,attrs:{class:"token title important"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("#")]),t._v(" 接下来，颠倒顺序，但保持成对排列")]),t._v("\n0D 22 00 03 -> 03 00 22 0D\n\n"),e("span",{pre:!0,attrs:{class:"token title important"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("#")]),t._v(" And now you have your final framebuffer profile")]),t._v("\n0300220D = AAPL,ig-platform-id\n")])])]),e("p",[t._v("From here, lets open up our config.plist and head to DeviceProperties -> Add. Now we'll want to add a new Entry called "),e("code",[t._v("PciRoot(0x0)/Pci(0x2,0x0)")]),t._v(". This is the location of Intel's iGPUs relative to the IOService path, and has been consistent as far back as Yonah series CPUs(2007+):")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("Key")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("Type")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("Value")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("AAPL,ig-platform-id")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Data")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("0300220D")])])])]),t._v(" "),e("p",[e("img",{attrs:{src:a(294),alt:""}})]),t._v(" "),e("h3",{attrs:{id:"device-id-explainer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#device-id-explainer"}},[t._v("#")]),t._v(" device-id explainer")]),t._v(" "),e("p",[e("code",[t._v("device-id")]),t._v(" is what macOS, or more specifically IOKit, uses to determine which devices are allowed to connect to which drivers. Why this is important for us is that Apple's iGPU drivers have a limited amount of IDs even though the kext itself can support much more.")]),t._v(" "),e("p",[t._v("To determine whether you need a new "),e("code",[t._v("device-id")]),t._v(" injected, you'll want to compare "),e("a",{attrs:{href:"https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.IntelHD.en.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("WhateverGreen's list of supported IDs"),e("OutboundLink")],1),t._v(" to what you have.")]),t._v(" "),e("p",[t._v("For this example, lets take a look at the i3-4150 with an HD 4400 iGPU. Using "),e("a",{attrs:{href:"https://ark.Intel.com/content/www/us/en/ark/products/77486/Intel-core-i3-4150-processor-3m-cache-3-50-ghz.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Intel's ARK page"),e("OutboundLink")],1),t._v(", we can see the following:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Device ID = 0x41E\n")])])]),e("p",[t._v("Now that we have our actual Device ID, lets compare it to "),e("a",{attrs:{href:"https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.IntelHD.en.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("WhateverGreen's list"),e("OutboundLink")],1),t._v(":")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Native supported DevIDs:\n\n 0x0d26\n 0x0a26\n 0x0a2e\n 0x0d22\n 0x0412\n")])])]),e("p",[t._v("Unfortunately the ID is not present in macOS, so we'll need to find a similar iGPU to ours and use their Device ID. The HD 4600 found in the "),e("a",{attrs:{href:"https://ark.Intel.com/content/www/us/en/ark/products/77769/Intel-core-i3-4330-processor-4m-cache-3-50-ghz.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("i3-4330"),e("OutboundLink")],1),t._v(" is a very close match, so we'll use its Device ID:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Device ID = 0x412\n")])])]),e("p",[t._v("However, by default this cannot be injected. We'll need to first pad it to 8 bits and hex swap:")]),t._v(" "),e("div",{staticClass:"language-md extra-class"},[e("pre",{pre:!0,attrs:{class:"language-md"}},[e("code",[e("span",{pre:!0,attrs:{class:"token title important"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("#")]),t._v(" First, remove 0x and pad it to 8 bits by using 0's in front of it")]),t._v("\n0x412 -> 00 00 04 12\n\n"),e("span",{pre:!0,attrs:{class:"token title important"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("#")]),t._v(" Next reverse it, but keep the pairs in tact")]),t._v("\n00 00 04 12 -> 12 04 00 00\n\n"),e("span",{pre:!0,attrs:{class:"token title important"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("#")]),t._v(" And voila, you have your device-id")]),t._v("\n12040000 = device-id\n")])])]),e("p",[t._v("Now that we have our device-id, we'll do the same thing as before with ig-platform-id. Open your config.plist and add this new entry under "),e("code",[t._v("PciRoot(0x0)/Pci(0x2,0x0)")]),t._v(":")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("Key")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("Type")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("Value")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("device-id")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("Data")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("12040000")])])])]),t._v(" "),e("p",[e("img",{attrs:{src:a(295),alt:""}})]),t._v(" "),e("h2",{attrs:{id:"learning-to-patch-with-whatevergreen"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#learning-to-patch-with-whatevergreen"}},[t._v("#")]),t._v(" Learning to patch with WhateverGreen")]),t._v(" "),e("p",[t._v("Now that we've gone over the basics of setting up an iGPU, let's get into some deeper topics. We'll need to go over some  prerequisites first:")]),t._v(" "),e("ul",[e("li",[t._v("Lilu and WhateverGreen are present under EFI/OC/Kexts and in your config.plist\n"),e("ul",[e("li",[t._v("To verify if they loaded correctly in macOS, run the below command(if nothing is outputted, the kexts are not loading)")]),t._v(" "),e("li",[e("code",[t._v('kextstat | grep -E "Lilu|WhateverGreen"')])])])]),t._v(" "),e("li",[e("code",[t._v("DeviceProperties -> Add -> PciRoot(0x0)/Pci(0x2,0x0)")]),t._v(" has been correctly setup\n"),e("ul",[e("li",[t._v("Refer to your specific generation in the "),e("a",{attrs:{href:"https://sumingyd.github.io/OpenCore-Install-Guide/",target:"_blank",rel:"noopener noreferrer"}},[t._v("config.plist section"),e("OutboundLink")],1)])])])]),t._v(" "),e("p",[t._v("Now head forth into your framebuffer patching journey!:")]),t._v(" "),e("ul",[e("li",[e("RouterLink",{attrs:{to:"/gpu-patching/intel-patching/vram.html"}},[t._v("Patching the VRAM requirement of macOS")]),t._v(" "),e("ul",[e("li",[t._v("Relevant for systems with locked BIOS and cannot increase the VRAM")])])],1),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/gpu-patching/intel-patching/connector.html"}},[t._v("Patching the display type")]),t._v(" "),e("ul",[e("li",[t._v("Relevant for systems where you may get distorted colors on certain monitors")])])],1),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/gpu-patching/intel-patching/busid.html"}},[t._v("Patching the display connections")]),t._v(" "),e("ul",[e("li",[t._v("Relevant for systems where certain display outputs do not work")])])],1)])])}),[],!1,null,null,null);e.default=n.exports}}]);